<!DOCTYPE html>
<html lang="{{ lang }}" {% if lang == 'ar' %}dir="rtl"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t.market_analytics }} - {{ t.site_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="{% if lang == 'ar' %}rtl{% endif %}">
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-logo"><a href="{{ url_for('index') }}">{{ t.site_name }}</a> - {{ company.name }}</h1>
            <div class="nav-info">
                <div class="nav-buttons">
                    <a href="{{ url_for('crm_dashboard') }}" class="btn btn-info">{{ t.crm_dashboard }}</a>
                    <div class="nav-controls">
                        <button onclick="toggleDarkMode()" class="btn btn-dark-toggle" title="Toggle Dark Mode">
                            <span class="dark-icon">ğŸŒ™</span>
                            <span class="light-icon">â˜€ï¸</span>
                        </button>
                        <div class="language-switcher">
                            <a href="{{ url_for('market_analytics', lang='en') }}" class="lang-btn {% if lang == 'en' %}active{% endif %}">EN</a>
                            <a href="{{ url_for('market_analytics', lang='ar') }}" class="lang-btn {% if lang == 'ar' %}active{% endif %}">Ø¹Ø±Ø¨ÙŠ</a>
                        </div>
                    </div>
                </div>
                <span class="user-info">
                    {% if session.user_type == 'employee' %}
                        {{ company.employees[session.employee_id].name }} ({{ session.role|title }})
                    {% else %}
                        {{ t.company_admin }}
                    {% endif %}
                </span>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">{{ t.logout }}</a>
            </div>
        </div>
    </nav>

    <div class="market-analytics-container">
        <div class="analytics-header">
            <h1>{{ t.market_analytics }}</h1>
            <p>{% if lang == 'ar' %}ØªØ­Ù„ÙŠÙ„Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø³ÙˆÙ‚ ÙˆØ§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©{% else %}Comprehensive Market and Campaign Analytics{% endif %}</p>
        </div>

        <!-- Supply & Demand Balance Section -->
        <div class="analytics-section">
            <div class="section-header">
                <h2>{{ t.supply_demand }}</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="downloadReport('supply-demand')">
                        {% if lang == 'ar' %}ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±{% else %}Download Report{% endif %}
                    </button>
                </div>
            </div>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>{% if lang == 'ar' %}Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚{% else %}Market Overview{% endif %}</h3>
                    <div class="market-stats">
                        <div class="stat-item">
                            <span class="stat-label">{% if lang == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¶{% else %}Total Supply{% endif %}</span>
                            <span class="stat-value">2,847</span>
                            <span class="stat-change positive">+12.5%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">{% if lang == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨{% else %}Total Demand{% endif %}</span>
                            <span class="stat-value">3,156</span>
                            <span class="stat-change positive">+8.3%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">{% if lang == 'ar' %}ÙØ¬ÙˆØ© Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø·Ù„Ø¨{% else %}Supply-Demand Gap{% endif %}</span>
                            <span class="stat-value">309</span>
                            <span class="stat-change negative">-4.2%</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>{% if lang == 'ar' %}ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª{% else %}Product Distribution{% endif %}</h3>
                    <div class="product-chart">
                        <div class="chart-item">
                            <span class="chart-label">{% if lang == 'ar' %}Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©{% else %}Heavy Equipment{% endif %}</span>
                            <div class="chart-bar">
                                <div class="bar-fill" style="width: 65%;">65%</div>
                            </div>
                        </div>
                        <div class="chart-item">
                            <span class="chart-label">{% if lang == 'ar' %}Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡{% else %}Construction Materials{% endif %}</span>
                            <div class="chart-bar">
                                <div class="bar-fill" style="width: 45%;">45%</div>
                            </div>
                        </div>
                        <div class="chart-item">
                            <span class="chart-label">{% if lang == 'ar' %}Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†{% else %}Safety Equipment{% endif %}</span>
                            <div class="chart-bar">
                                <div class="bar-fill" style="width: 30%;">30%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>{% if lang == 'ar' %}Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø³ÙˆÙ‚{% else %}Market Trends{% endif %}</h3>
                    <div class="trend-chart">
                        <div class="trend-line">
                            <div class="trend-point" style="left: 10%; bottom: 20%;"></div>
                            <div class="trend-point" style="left: 25%; bottom: 35%;"></div>
                            <div class="trend-point" style="left: 40%; bottom: 45%;"></div>
                            <div class="trend-point" style="left: 55%; bottom: 60%;"></div>
                            <div class="trend-point" style="left: 70%; bottom: 55%;"></div>
                            <div class="trend-point" style="left: 85%; bottom: 70%;"></div>
                        </div>
                        <div class="trend-labels">
                            <span>{% if lang == 'ar' %}ÙŠÙ†Ø§ÙŠØ±{% else %}Jan{% endif %}</span>
                            <span>{% if lang == 'ar' %}Ù…Ø§Ø±Ø³{% else %}Mar{% endif %}</span>
                            <span>{% if lang == 'ar' %}Ù…Ø§ÙŠÙˆ{% else %}May{% endif %}</span>
                            <span>{% if lang == 'ar' %}ÙŠÙˆÙ„ÙŠÙˆ{% else %}Jul{% endif %}</span>
                            <span>{% if lang == 'ar' %}Ø³Ø¨ØªÙ…Ø¨Ø±{% else %}Sep{% endif %}</span>
                            <span>{% if lang == 'ar' %}Ù†ÙˆÙÙ…Ø¨Ø±{% else %}Nov{% endif %}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports & Ads Download Section -->
        <div class="analytics-section">
            <div class="section-header">
                <h2>{{ t.download_reports }}</h2>
            </div>
            
            <div class="reports-grid">
                <div class="report-card">
                    <div class="report-icon">ğŸ“Š</div>
                    <h3>{% if lang == 'ar' %}ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø´Ù‡Ø±ÙŠ{% else %}Monthly Market Analysis Report{% endif %}</h3>
                    <p>{% if lang == 'ar' %}ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†{% else %}Comprehensive analysis of market trends and competitors{% endif %}</p>
                    <button class="btn btn-primary" onclick="downloadReport('monthly-analysis')">
                        {% if lang == 'ar' %}ØªÙ†Ø²ÙŠÙ„ PDF{% else %}Download PDF{% endif %}
                    </button>
                </div>

                <div class="report-card">
                    <div class="report-icon">ğŸ“ˆ</div>
                    <h3>{% if lang == 'ar' %}ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª{% else %}Sales Performance Report{% endif %}</h3>
                    <p>{% if lang == 'ar' %}ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚Ø©{% else %}Sales and revenue details by product and region{% endif %}</p>
                    <button class="btn btn-primary" onclick="downloadReport('sales-performance')">
                        {% if lang == 'ar' %}ØªÙ†Ø²ÙŠÙ„ PDF{% else %}Download PDF{% endif %}
                    </button>
                </div>

                <div class="report-card">
                    <div class="report-icon">ğŸ¯</div>
                    <h3>{% if lang == 'ar' %}Ù…ÙˆØ§Ø¯ Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ù„Ù„Ø­Ù…Ù„Ø§Øª{% else %}Campaign Advertisement Materials{% endif %}</h3>
                    <p>{% if lang == 'ar' %}Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…{% else %}Ready-to-use advertising materials collection{% endif %}</p>
                    <button class="btn btn-secondary" onclick="downloadAds('campaign-materials')">
                        {% if lang == 'ar' %}ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø­Ø²Ù…Ø©{% else %}Download Package{% endif %}
                    </button>
                </div>

                <div class="report-card">
                    <div class="report-icon">ğŸ“‹</div>
                    <h3>{% if lang == 'ar' %}ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†{% else %}Competitor Analysis Report{% endif %}</h3>
                    <p>{% if lang == 'ar' %}Ø¯Ø±Ø§Ø³Ø© Ù…ÙØµÙ„Ø© Ù„Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ† ÙˆØ§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§ØªÙ‡Ù…{% else %}Detailed study of competitors and their strategies{% endif %}</p>
                    <button class="btn btn-primary" onclick="downloadReport('competitor-analysis')">
                        {% if lang == 'ar' %}ØªÙ†Ø²ÙŠÙ„ PDF{% else %}Download PDF{% endif %}
                    </button>
                </div>
            </div>
        </div>

        <!-- Campaign Analysis Section -->
        <div class="analytics-section">
            <div class="section-header">
                <h2>{{ t.campaign_analysis }}</h2>
            </div>
            
            <div class="campaigns-container">
                <!-- Current Campaigns -->
                <div class="campaigns-section">
                    <h3>{% if lang == 'ar' %}Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ©{% else %}Current Campaigns{% endif %}</h3>
                    <div class="campaign-list">
                        <div class="campaign-card active">
                            <div class="campaign-header">
                                <h4>{% if lang == 'ar' %}Ø­Ù…Ù„Ø© Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø´ØªØ§Ø¡{% else %}Winter Equipment Campaign{% endif %}</h4>
                                <span class="campaign-status active">{% if lang == 'ar' %}Ù†Ø´Ø·Ø©{% else %}Active{% endif %}</span>
                            </div>
                            <div class="campaign-metrics">
                                <div class="metric">
                                    <span class="metric-label">{% if lang == 'ar' %}Ø§Ù„ÙˆØµÙˆÙ„{% else %}Reach{% endif %}</span>
                                    <span class="metric-value">45,230</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">{% if lang == 'ar' %}Ø§Ù„ØªÙØ§Ø¹Ù„{% else %}Engagement{% endif %}</span>
                                    <span class="metric-value">12.5%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">{% if lang == 'ar' %}Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª{% else %}Conversions{% endif %}</span>
                                    <span class="metric-value">234</span>
                                </div>
                            </div>
                            <div class="campaign-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 68%;"></div>
                                </div>
                                <span class="progress-text">68% {% if lang == 'ar' %}Ù…ÙƒØªÙ…Ù„Ø©{% else %}Complete{% endif %}</span>
                            </div>
                        </div>

                        <div class="campaign-card active">
                            <div class="campaign-header">
                                <h4>{% if lang == 'ar' %}Ø­Ù…Ù„Ø© Ø§Ù„Ø®Ø±Ø³Ø§Ù†Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©{% else %}Ready-Mix Concrete Campaign{% endif %}</h4>
                                <span class="campaign-status active">{% if lang == 'ar' %}Ù†Ø´Ø·Ø©{% else %}Active{% endif %}</span>
                            </div>
                            <div class="campaign-metrics">
                                <div class="metric">
                                    <span class="metric-label">{% if lang == 'ar' %}Ø§Ù„ÙˆØµÙˆÙ„{% else %}Reach{% endif %}</span>
                                    <span class="metric-value">32,180</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">{% if lang == 'ar' %}Ø§Ù„ØªÙØ§Ø¹Ù„{% else %}Engagement{% endif %}</span>
                                    <span class="metric-value">8.7%</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">{% if lang == 'ar' %}Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª{% else %}Conversions{% endif %}</span>
                                    <span class="metric-value">156</span>
                                </div>
                            </div>
                            <div class="campaign-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 45%;"></div>
                                </div>
                                <span class="progress-text">45% {% if lang == 'ar' %}Ù…ÙƒØªÙ…Ù„Ø©{% else %}Complete{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Previous Campaigns -->
                <div class="campaigns-section">
                    <h3>{% if lang == 'ar' %}Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©{% else %}Previous Campaigns{% endif %}</h3>
                    <div class="campaign-list">
                        <div class="campaign-card completed">
                            <div class="campaign-header">
                                <h4>{% if lang == 'ar' %}Ø­Ù…Ù„Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØµÙŠÙÙŠØ©{% else %}Summer Deals Campaign{% endif %}</h4>
                                <span class="campaign-status completed">{% if lang == 'ar' %}Ù…ÙƒØªÙ…Ù„Ø©{% else %}Completed{% endif %}</span>
                            </div>
                            <div class="campaign-results">
                                <div class="result-item">
                                    <span class="result-label">{% if lang == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙˆÙ„{% else %}Total Reach{% endif %}</span>
                                    <span class="result-value">78,450</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">{% if lang == 'ar' %}Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„{% else %}Conversion Rate{% endif %}</span>
                                    <span class="result-value">15.2%</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">{% if lang == 'ar' %}Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±{% else %}ROI{% endif %}</span>
                                    <span class="result-value positive">+245%</span>
                                </div>
                            </div>
                        </div>

                        <div class="campaign-card completed">
                            <div class="campaign-header">
                                <h4>{% if lang == 'ar' %}Ø­Ù…Ù„Ø© Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯{% else %}New Product Launch Campaign{% endif %}</h4>
                                <span class="campaign-status completed">{% if lang == 'ar' %}Ù…ÙƒØªÙ…Ù„Ø©{% else %}Completed{% endif %}</span>
                            </div>
                            <div class="campaign-results">
                                <div class="result-item">
                                    <span class="result-label">{% if lang == 'ar' %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙˆÙ„{% else %}Total Reach{% endif %}</span>
                                    <span class="result-value">52,300</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">{% if lang == 'ar' %}Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„{% else %}Conversion Rate{% endif %}</span>
                                    <span class="result-value">11.8%</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">{% if lang == 'ar' %}Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±{% else %}ROI{% endif %}</span>
                                    <span class="result-value positive">+180%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function downloadReport(reportType) {
            // Simulate report download
            const reportNames = {
                'supply-demand': 'Supply_Demand_Analysis_2024.pdf',
                'monthly-analysis': 'Monthly_Market_Analysis_Dec2024.pdf',
                'sales-performance': 'Sales_Performance_Report_Q4.pdf',
                'competitor-analysis': 'Competitor_Analysis_Report.pdf'
            };
            
            const fileName = reportNames[reportType] || 'Report.pdf';
            alert(`{% if lang == 'ar' %}Ø¬Ø§Ø±ÙŠ ØªÙ†Ø²ÙŠÙ„: ${fileName}{% else %}Downloading: ${fileName}{% endif %}`);
        }
        
        function downloadAds(packageType) {
            alert(`{% if lang == 'ar' %}Ø¬Ø§Ø±ÙŠ ØªÙ†Ø²ÙŠÙ„ Ø­Ø²Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©...{% else %}Downloading advertising materials package...{% endif %}`);
        }
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
        
        // Load dark mode preference
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
</body>
</html>